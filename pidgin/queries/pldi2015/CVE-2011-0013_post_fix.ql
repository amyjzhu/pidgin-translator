// File: queries/CVE-2011-0013_post_fix.ql
// All sources of information provided by the application that may be displayed by the HTMLManager
let sources = 
  pdg.normalExits("Context.getPath").forProcedure("HTMLManagerServlet") OR
  pdg.normalExits("Context.getWebappVersion").forProcedure("HTMLManagerServlet") OR
  //pdg.normalExits("ContextName.getPath").forProcedure("HTMLManagerServlet") OR
  pdg.normalExits("ContextName.getDisplayName").forProcedure("HTMLManagerServlet") OR
  pdg.normalExits("Context.getDisplayName").forProcedure("HTMLManagerServlet") OR
  pdg.normalExits("StringManager.getString").forProcedure("HTMLManagerServlet.doGet")
// MessageFormat Object[] argument, String.toCharArray char[] allocation from ObjectName.construct
in

// Call _sites_ to the printer
let sinks = pdg.actualsOf("CoyoteWriter.print") in

let sanitizers = 
    // If the name is filtered then it is safe to display
    pdg.forProcedure("RequestUtil.filter")
 OR pdg.forProcedure("URLEncoder.encode") 
 OR pdg.forProcedure("StatusTransformer.filter")
in
pdg.explicitGraph.removeNodes(sanitizers).cfl(sources, sinks) is empty
